<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="‚ú® LUCY'S RUN ‚ú® - Endless runner retr√≤ con le canzoni di Marta La Noce">
    <meta name="theme-color" content="#FF1493">
    <title>‚ú® LUCY'S RUN ‚ú® - Marta La Noce</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTFVDWSdTIFJVTiIsInNob3J0X25hbWUiOiJMdWN5J3MgUnVuIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwMDAwMDAiLCJ0aGVtZV9jb2xvciI6IiNGRjE0OTMifQ==">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: none;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #000;
            box-shadow: 0 0 50px rgba(255, 20, 147, 0.5);
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #1a0033 0%, #330066 100%);
            overflow-y: auto;
        }

        .screen.active {
            display: flex;
        }

        /* Scanlines effect */
        .screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }

        .title-logo {
            font-size: clamp(24px, 8vw, 48px);
            text-align: center;
            margin: 20px;
            text-shadow:
                0 0 10px #FF1493,
                0 0 20px #FF1493,
                0 0 30px #FF1493,
                3px 3px 0 #00FFFF;
            animation: glow 2s ease-in-out infinite;
            cursor: pointer;
            user-select: none;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px #FF1493, 0 0 20px #FF1493, 0 0 30px #FF1493, 3px 3px 0 #00FFFF; }
            50% { text-shadow: 0 0 20px #FF1493, 0 0 40px #FF1493, 0 0 60px #FF1493, 3px 3px 0 #00FFFF; }
        }

        .lucy-art {
            width: clamp(150px, 40vw, 250px);
            height: clamp(150px, 40vw, 250px);
            margin: 20px;
            background: linear-gradient(135deg, #FF69B4 0%, #87CEEB 100%);
            border-radius: 50%;
            border: 4px solid #00FFFF;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(40px, 12vw, 80px);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .press-start {
            font-size: clamp(14px, 4vw, 20px);
            margin: 30px;
            color: #FFD700;
            text-shadow: 0 0 10px #FFD700;
            animation: blink 1s step-end infinite;
            cursor: pointer;
            padding: 15px 30px;
            border: 3px solid #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .artist-credit {
            font-size: clamp(10px, 3vw, 14px);
            margin: 10px;
            color: #FF69B4;
            text-align: center;
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .social-links a {
            color: #00FFFF;
            text-decoration: none;
            font-size: clamp(10px, 3vw, 12px);
            padding: 10px 20px;
            border: 2px solid #00FFFF;
            background: rgba(0, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .social-links a:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px #00FFFF;
        }

        .easter-egg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            flex-direction: column;
        }

        .rainbow {
            font-size: clamp(20px, 6vw, 40px);
            text-align: center;
            padding: 20px;
            animation: rainbow 2s linear infinite, blink 0.5s step-end infinite;
        }

        @keyframes rainbow {
            0% { color: #FF0000; text-shadow: 0 0 30px #FF0000; }
            16% { color: #FF7F00; text-shadow: 0 0 30px #FF7F00; }
            32% { color: #FFFF00; text-shadow: 0 0 30px #FFFF00; }
            48% { color: #00FF00; text-shadow: 0 0 30px #00FF00; }
            64% { color: #0000FF; text-shadow: 0 0 30px #0000FF; }
            80% { color: #4B0082; text-shadow: 0 0 30px #4B0082; }
            100% { color: #8B00FF; text-shadow: 0 0 30px #8B00FF; }
        }

        .level-menu {
            padding: 20px;
            max-width: 800px;
            width: 90%;
        }

        .menu-title {
            font-size: clamp(18px, 5vw, 32px);
            text-align: center;
            margin-bottom: 30px;
            color: #FFD700;
            text-shadow: 0 0 10px #FFD700;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .level-card {
            padding: 20px;
            border: 3px solid;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .level-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px;
        }

        .level-card.spring {
            border-color: #FF69B4;
            color: #FF69B4;
        }

        .level-card.spring:hover {
            box-shadow: 0 0 30px #FF69B4;
        }

        .level-card.summer {
            border-color: #FFD700;
            color: #FFD700;
        }

        .level-card.summer:hover {
            box-shadow: 0 0 30px #FFD700;
        }

        .level-card.autumn {
            border-color: #FF8C00;
            color: #FF8C00;
        }

        .level-card.autumn:hover {
            box-shadow: 0 0 30px #FF8C00;
        }

        .level-card.winter {
            border-color: #00FFFF;
            color: #00FFFF;
        }

        .level-card.winter:hover {
            box-shadow: 0 0 30px #00FFFF;
        }

        .level-icon {
            font-size: clamp(30px, 8vw, 50px);
            margin: 10px 0;
        }

        .level-name {
            font-size: clamp(12px, 3.5vw, 18px);
            margin: 10px 0;
        }

        .level-song {
            font-size: clamp(10px, 2.5vw, 14px);
            opacity: 0.8;
        }

        .back-button {
            font-size: clamp(12px, 3vw, 16px);
            padding: 15px 30px;
            border: 3px solid #FF1493;
            background: rgba(255, 20, 147, 0.2);
            color: #FF1493;
            cursor: pointer;
            margin: 20px auto;
            display: block;
        }

        .back-button:hover {
            background: rgba(255, 20, 147, 0.4);
            box-shadow: 0 0 20px #FF1493;
        }

        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: none;
            flex-direction: column;
            gap: 10px;
            font-size: clamp(10px, 2.5vw, 16px);
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
            z-index: 100;
            pointer-events: none;
        }

        #hud.active {
            display: flex;
        }

        .hud-row {
            display: flex;
            justify-content: space-between;
        }

        .transformation-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #FFD700;
            margin-top: 5px;
            position: relative;
        }

        .transformation-fill {
            height: 100%;
            background: linear-gradient(90deg, #1E90FF, #FF69B4, #FFD700);
            width: 0%;
            transition: width 0.3s;
        }

        .transformation-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(8px, 2vw, 12px);
            color: #FFF;
            text-shadow: 1px 1px 2px #000;
            white-space: nowrap;
        }

        .game-over-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border: 4px solid #FF1493;
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            z-index: 200;
            max-width: 90%;
        }

        .game-over-screen.active {
            display: flex;
        }

        .game-over-title {
            font-size: clamp(20px, 6vw, 36px);
            color: #FF1493;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #FF1493;
        }

        .final-score {
            font-size: clamp(16px, 4vw, 24px);
            color: #FFD700;
            margin: 20px 0;
        }

        .game-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .game-button {
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(10px, 2.5vw, 14px);
            padding: 15px 25px;
            border: 3px solid;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }

        .retry-button {
            border-color: #00FF00;
            color: #00FF00;
        }

        .retry-button:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px #00FF00;
        }

        .menu-button {
            border-color: #FFD700;
            color: #FFD700;
        }

        .menu-button:hover {
            background: rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 20px #FFD700;
        }

        @media (max-width: 600px) {
            .level-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Title Screen -->
    <div id="titleScreen" class="screen active">
        <div class="title-logo" id="titleLogo">‚ú® LUCY'S RUN ‚ú®</div>
        <div class="lucy-art">ü¶ã</div>
        <div class="press-start" id="startButton">‚ñ∂ PRESS START ‚óÄ</div>
        <div class="artist-credit">üé§ Un gioco di Marta La Noce üé∂</div>
        <div class="social-links">
            <a href="https://www.instagram.com/soylanoce?igsh=dG55anZuZzR0cTA5" target="_blank">üíñ Instagram - Lascia un Mi Piace!</a>
            <a href="https://open.spotify.com/artist/4YE8qxQc4RJMkk0UqElT3S?si=cEP9jExYSeGFVyrUenC6qA" target="_blank">üéµ Spotify</a>
            <a href="https://www.youtube.com/@MartaLaNoce" target="_blank">üíô YouTube</a>
        </div>
    </div>

    <!-- Easter Egg -->
    <div class="easter-egg" id="easterEgg">
        <div class="rainbow">üåà VIVA LA LIBERT√Ä üè≥Ô∏è‚Äç‚ößÔ∏è</div>
        <div class="rainbow" style="animation-delay: 0.3s;">üåà VIVA LA LIBERT√Ä üè≥Ô∏è‚Äç‚ößÔ∏è</div>
        <div class="rainbow" style="animation-delay: 0.6s;">üåà VIVA LA LIBERT√Ä üè≥Ô∏è‚Äç‚ößÔ∏è</div>
    </div>

    <!-- Level Menu -->
    <div id="levelMenu" class="screen">
        <div class="level-menu">
            <div class="menu-title">üéµ SCEGLI IL TUO VIAGGIO üéµ</div>
            <div class="level-grid">
                <div class="level-card spring" data-level="spring">
                    <div class="level-icon">üå∏</div>
                    <div class="level-name">PRIMAVERA</div>
                    <div class="level-song">"Lucy"</div>
                </div>
                <div class="level-card summer" data-level="summer">
                    <div class="level-icon">‚òÄÔ∏è</div>
                    <div class="level-name">ESTATE</div>
                    <div class="level-song">"Libera"</div>
                </div>
                <div class="level-card autumn" data-level="autumn">
                    <div class="level-icon">üçÇ</div>
                    <div class="level-name">AUTUNNO</div>
                    <div class="level-song">"Nuotare"</div>
                </div>
                <div class="level-card winter" data-level="winter">
                    <div class="level-icon">‚ùÑÔ∏è</div>
                    <div class="level-name">INVERNO</div>
                    <div class="level-song">"Nuvole Nere"</div>
                </div>
            </div>
            <button class="back-button" id="backToTitle">‚óÄ TORNA AL TITOLO</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <canvas id="gameCanvas"></canvas>
        <div id="hud">
            <div class="hud-row">
                <div id="scoreDisplay">SCORE: 0</div>
                <div id="levelDisplay">üå∏ PRIMAVERA</div>
            </div>
            <div class="transformation-bar">
                <div class="transformation-fill" id="transformationFill"></div>
                <div class="transformation-text" id="transformationText">TRASFORMAZIONE: 0%</div>
            </div>
        </div>
        <div class="game-over-screen" id="gameOver">
            <div class="game-over-title">GAME OVER!</div>
            <div class="final-score" id="finalScore">SCORE: 0</div>
            <div class="game-buttons">
                <button class="game-button retry-button" id="retryButton">üîÑ RIPROVA</button>
                <button class="game-button menu-button" id="menuButton">üìã MENU</button>
            </div>
        </div>
    </div>

    <script>
        // Game Configuration
        const CONFIG = {
            fps: 60,
            gravity: 0.8,
            jumpForce: -15,
            scrollSpeed: 5,
            scrollSpeedMax: 12,
            speedIncrement: 0.005,
            obstacleSpawnRate: 90,
            powerUpSpawnRate: 200,
            transformationStages: 5,
            pointsPerStage: 200, // 200 punti per ogni stadio di trasformazione
            victoryScore: 1000,  // Punteggio per completare la trasformazione

            levels: {
                spring: {
                    name: 'üå∏ PRIMAVERA',
                    colors: {
                        sky: ['#FFB3D9', '#B3E5FC'],
                        ground: '#90EE90',
                        player: '#FF69B4',
                        obstacles: ['#FF1493', '#FFFFFF', '#90EE90']
                    },
                    obstacleTypes: ['flower', 'fence', 'butterfly']
                },
                summer: {
                    name: '‚òÄÔ∏è ESTATE',
                    colors: {
                        sky: ['#FFD700', '#FF8C00'],
                        ground: '#F4A460',
                        player: '#FF69B4',
                        obstacles: ['#FFD700', '#FF1493', '#00BFFF']
                    },
                    obstacleTypes: ['ball', 'castle', 'seagull']
                },
                autumn: {
                    name: 'üçÇ AUTUNNO',
                    colors: {
                        sky: ['#FF8C00', '#8B4513'],
                        ground: '#CD853F',
                        player: '#FF69B4',
                        obstacles: ['#FF4500', '#8B4513', '#FFD700']
                    },
                    obstacleTypes: ['leaves', 'mushroom', 'squirrel']
                },
                winter: {
                    name: '‚ùÑÔ∏è INVERNO',
                    colors: {
                        sky: ['#87CEEB', '#4169E1'],
                        ground: '#FFFFFF',
                        player: '#FF69B4',
                        obstacles: ['#00FFFF', '#FFFFFF', '#9370DB']
                    },
                    obstacleTypes: ['ice', 'snowman', 'icicle']
                }
            }
        };

        // Game State
        let gameState = {
            currentScreen: 'title',
            currentLevel: null,
            score: 0,
            isPlaying: false,
            frame: 0,
            currentSpeed: CONFIG.scrollSpeed,
            playerSize: 'normal', // normal, big, small
            transformationStage: 0 // 0 = masculine, 5 = fully feminine
        };

        // Easter Egg Counter
        let clickCount = 0;
        let clickTimer = null;

        // Canvas Setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const maxWidth = 800;
            const maxHeight = 600;
            const ratio = maxWidth / maxHeight;

            let width = window.innerWidth;
            let height = window.innerHeight;

            if (width / height > ratio) {
                width = height * ratio;
            } else {
                height = width / ratio;
            }

            canvas.width = Math.min(width, maxWidth);
            canvas.height = Math.min(height, maxHeight);
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game Objects
        class Player {
            constructor() {
                this.baseWidth = 40;
                this.baseHeight = 40;
                this.width = this.baseWidth;
                this.height = this.baseHeight;
                this.x = 100;
                this.y = canvas.height - 100 - this.height;
                this.velocityY = 0;
                this.isJumping = false;
                this.sizeTimer = 0;
            }

            setSize(size) {
                const oldHeight = this.height;

                if (size === 'big') {
                    this.width = this.baseWidth * 1.5;
                    this.height = this.baseHeight * 1.5;
                    this.sizeTimer = 300; // 5 seconds at 60fps
                } else if (size === 'small') {
                    this.width = this.baseWidth * 0.6;
                    this.height = this.baseHeight * 0.6;
                    this.sizeTimer = 300;
                } else {
                    this.width = this.baseWidth;
                    this.height = this.baseHeight;
                    this.sizeTimer = 0;
                }

                // Adjust Y position when size changes
                this.y += (oldHeight - this.height);
            }

            jump() {
                if (!this.isJumping) {
                    this.velocityY = CONFIG.jumpForce;
                    this.isJumping = true;
                }
            }

            update() {
                this.velocityY += CONFIG.gravity;
                this.y += this.velocityY;

                const groundY = canvas.height - 100 - this.height;
                if (this.y >= groundY) {
                    this.y = groundY;
                    this.velocityY = 0;
                    this.isJumping = false;
                }

                // Handle size timer
                if (this.sizeTimer > 0) {
                    this.sizeTimer--;
                    if (this.sizeTimer === 0) {
                        this.setSize('normal');
                        gameState.playerSize = 'normal';
                    }
                }
            }

            draw(color) {
                const stage = gameState.transformationStage;

                ctx.fillStyle = color;
                // Body
                ctx.fillRect(this.x, this.y, this.width, this.height);

                // Eyes (proportional to size)
                const eyeSize = Math.max(4, this.width / 5);
                const eyeOffset = this.width / 5;
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(this.x + eyeOffset, this.y + this.height * 0.25, eyeSize, eyeSize);
                ctx.fillRect(this.x + this.width - eyeOffset - eyeSize, this.y + this.height * 0.25, eyeSize, eyeSize);

                // Pupils
                const pupilSize = Math.max(2, eyeSize / 2);
                ctx.fillStyle = '#000000';
                ctx.fillRect(this.x + eyeOffset + eyeSize/4, this.y + this.height * 0.25 + eyeSize/4, pupilSize, pupilSize);
                ctx.fillRect(this.x + this.width - eyeOffset - eyeSize + eyeSize/4, this.y + this.height * 0.25 + eyeSize/4, pupilSize, pupilSize);

                // Smile
                const smileWidth = this.width * 0.4;
                const smileHeight = Math.max(3, this.height / 10);
                ctx.fillRect(this.x + (this.width - smileWidth) / 2, this.y + this.height * 0.7, smileWidth, smileHeight);

                // TRANSFORMATION STAGES

                // Stage 0: Short hair (masculine)
                if (stage === 0) {
                    ctx.fillStyle = '#8B4513'; // Brown hair
                    ctx.fillRect(this.x, this.y - this.height * 0.15, this.width, this.height * 0.15);
                }

                // Stage 1: Growing hair
                if (stage >= 1) {
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(this.x, this.y - this.height * 0.2, this.width, this.height * 0.2);
                    ctx.fillRect(this.x - this.width * 0.1, this.y, this.width * 0.1, this.height * 0.3);
                    ctx.fillRect(this.x + this.width, this.y, this.width * 0.1, this.height * 0.3);
                }

                // Stage 2: Long hair + earrings
                if (stage >= 2) {
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(this.x - this.width * 0.15, this.y, this.width * 0.15, this.height * 0.5);
                    ctx.fillRect(this.x + this.width, this.y, this.width * 0.15, this.height * 0.5);

                    // Earrings
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(this.x - this.width * 0.08, this.y + this.height * 0.3, this.width * 0.08, this.width * 0.08);
                    ctx.fillRect(this.x + this.width, this.y + this.height * 0.3, this.width * 0.08, this.width * 0.08);
                }

                // Stage 3: Dress/skirt
                if (stage >= 3) {
                    ctx.fillStyle = '#FF69B4'; // Pink dress
                    // Triangle-ish dress
                    ctx.fillRect(this.x + this.width * 0.1, this.y + this.height * 0.5, this.width * 0.8, this.height * 0.15);
                    ctx.fillRect(this.x, this.y + this.height * 0.65, this.width, this.height * 0.35);
                }

                // Stage 4: Makeup + accessories
                if (stage >= 4) {
                    // Lipstick
                    ctx.fillStyle = '#FF1493';
                    ctx.fillRect(this.x + this.width * 0.3, this.y + this.height * 0.72, this.width * 0.4, smileHeight);

                    // Eyelashes
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(this.x + eyeOffset - 2, this.y + this.height * 0.25 - 3, eyeSize + 4, 2);
                    ctx.fillRect(this.x + this.width - eyeOffset - eyeSize - 2, this.y + this.height * 0.25 - 3, eyeSize + 4, 2);

                    // Necklace
                    ctx.fillStyle = '#